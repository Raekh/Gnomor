(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{25:function(t,e,n){t.exports=n(63)},30:function(t,e,n){},31:function(t,e,n){},32:function(t,e,n){},33:function(t,e,n){},46:function(t,e,n){},47:function(t,e,n){},48:function(t,e,n){},49:function(t,e,n){},50:function(t,e,n){},51:function(t,e,n){},52:function(t,e,n){},53:function(t,e,n){},62:function(t,e,n){},63:function(t,e,n){"use strict";n.r(e);var a=n(0),o=n.n(a),i=n(17),l=n.n(i),r=(n(30),n(5)),c=n(6),s=n(8),u=n(7),d=n(9),m=n(12),h=n(11),E=(n(31),void 0),p=o.a.createContext({token:null,userId:null,tokenExpiration:null,login:function(t,e,n){console.log("LOGGING"),E.token=t,E.userId=e,E.tokenExpiration=n},logout:function(){E.token=null,E.userId=null,E.tokenExpiration=null}}),f=function(t){function e(t){var n;return Object(r.a)(this,e),(n=Object(s.a)(this,Object(u.a)(e).call(this,t))).handleSwitch=function(){n.setState(function(t){return{isLogin:!t.isLogin}})},n.submitHandler=function(t){t.preventDefault();var e=n.emailEl.current.value,a=n.passwordEl.current.value;if(0!==e.trim().length&&0!==a.trim().length){var o={query:"\n\t\t\tquery Login($email: String!, $password: String!){\n\t\t\t\tlogin(email: $email, password: $password){\n\t\t\t\t\tuserId\n\t\t\t\t\ttoken\n\t\t\t\t\ttokenExpiration\n\t\t\t\t}\n\t\t\t}\n\t\t\t",variables:{email:e,password:a}};n.state.isLogin||(o={query:"\n\t\t\t\t\tmutation CreateUser($email: String!, $password: String!){\n\t\t\t\t\t\tcreateUser(userInput: {\n\t\t\t\t\t\t\temail: $email\n\t\t\t\t\t\t\tpassword: $password     \n\t\t\t\t\t\t}){\n\t\t\t\t\t\t\t_id\n\t\t\t\t\t\t\temail\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t",variables:{email:e,password:a}}),fetch("http://localhost:8000/graphql",{method:"POST",body:JSON.stringify(o),headers:{"Content-Type":"application/json"}}).then(function(t){if(200!==t.status&&201!==t.status)throw new Error("Failed");return t.json()}).then(function(t){if(n.state.isLogin&&t.data.login.token){console.log("%c resdata","color:orange",t.data.login);var e=t.data.login,a=e.token,o=e.userId,i=e.tokenExpiration;console.log("%c token","color:red",a),n.context.login(a,o,i),console.log(n.context)}}).catch(function(t){console.log(t)})}},n.emailEl=o.a.createRef(),n.passwordEl=o.a.createRef(),n.state={isLogin:!0},console.log("%c context","color:orange",n.context),n}return Object(d.a)(e,t),Object(c.a)(e,[{key:"render",value:function(){return o.a.createElement("form",{className:"auth-form",onSubmit:this.submitHandler},o.a.createElement("div",{className:"form-control"},o.a.createElement("label",{htmlFor:"email"},"E-mail"),o.a.createElement("input",{type:"email",id:"email",ref:this.emailEl})),o.a.createElement("div",{className:"form-control"},o.a.createElement("label",{htmlFor:"password"},"Password"),o.a.createElement("input",{type:"password",id:"password",ref:this.passwordEl})),o.a.createElement("div",{className:"form-actions"},o.a.createElement("button",{type:"submit"},"Submit"),o.a.createElement("button",{type:"button",onClick:this.handleSwitch},"Switch to ",this.state.isLogin?"Signup":"Login")))}}]),e}(a.Component);f.contextType=p;var v=f,g=(n(32),function(t){return o.a.createElement("ul",{className:"booking__list"},t.bookings.map(function(e){return o.a.createElement("li",{key:e._id,className:"booking__item"},o.a.createElement("div",{className:"booking__item-data"},e.event.title," - ",new Date(e.createdAt).toLocaleDateString()),o.a.createElement("div",{className:"booking__item-action"},o.a.createElement("button",{className:"btn",onClick:t.onDelete.bind(void 0,e._id)},"Cancel")))}))}),b=(n(33),function(){return o.a.createElement("div",{className:"spinner"},o.a.createElement("div",{className:"lds-ellipsis"},o.a.createElement("div",null),o.a.createElement("div",null),o.a.createElement("div",null),o.a.createElement("div",null)))}),k=n(14),y=n(22),C=(n(46),{Cheap:{min:0,max:100},Normal:{min:100,max:200},Expensive:{min:200,max:1e4}}),S=function(t){var e={labels:[],datasets:[]},n=[],a=function(a){var o=t.bookings.reduce(function(t,e){return e.event.price>C[a].min&&e.event.price<=C[a].max?t+1:t},0);n.push(o),e.labels.push(a),e.datasets.push({fillColor:"rgba(220, 220, 220, 0.5)",strokeColor:"rgba(220, 220, 220, 0.8)",highlightFill:"rgba(220, 220, 220, 0.75)",highlightStroke:"rgba(220, 220, 220, 1)",data:n}),(n=Object(k.a)(n))[n.length-1]=0};for(var i in C)a(i);return o.a.createElement("div",{className:"barchart"},o.a.createElement(y.Bar,{data:e}))},w=(n(47),function(t){return o.a.createElement("div",{className:"booking-control"},o.a.createElement("button",{className:"list"===t.activeOutputType?"active":"",onClick:t.onChange.bind(void 0,"list")},"List"),o.a.createElement("button",{className:"chart"===t.activeOutputType?"active":"",onClick:t.onChange.bind(void 0,"chart")},"Chart"))}),N=function(t){function e(t){var n;return Object(r.a)(this,e),(n=Object(s.a)(this,Object(u.a)(e).call(this,t))).componentDidMount=function(){n.fetchBookings()},n.fetchBookings=function(){if(n.context.token){n.setState({isLoading:!0});fetch("http://localhost:8000/graphql",{method:"POST",body:JSON.stringify({query:"\n\t\t\t{\n\t\t\t\tbookings\n\t\t\t\t{\n\t\t\t\t\t_id\n\t\t\t\t\tcreatedAt\n\t\t\t\t\tevent{\n\t\t\t\t\t\t_id\n\t\t\t\t\t\ttitle\n\t\t\t\t\t\tdate\n\t\t\t\t\t\tprice\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\t"}),headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(n.context.token)}}).then(function(t){if(200!==t.status&&201!==t.status)throw new Error("Failed");return t.json()}).then(function(t){var e=t.data.bookings;n.setState({isLoading:!1,bookings:e,selectedEvent:null})}).catch(function(t){console.log(t)})}},n.deleteBookingHandler=function(t){if(n.context.token){n.setState({isLoading:!0});var e={query:"\n\t\t\tmutation CancelBooking($id: ID!){\n\t\t\t\tcancelBooking(bookingId: $id)\n\t\t\t\t{\n\t\t\t\t\t_id\n\t\t\t\t\ttitle\n\t\t\t\t}\n\t\t\t}\n\t\t\t",variables:{id:t}};fetch("http://localhost:8000/graphql",{method:"POST",body:JSON.stringify(e),headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(n.context.token)}}).then(function(t){if(200!==t.status&&201!==t.status)throw new Error("Failed");return t.json()}).then(function(e){n.setState(function(e){return{bookings:e.bookings.filter(function(e){return e._id!==t}),isLoading:!1}})}).catch(function(t){console.log("%c error","color:red",t)})}},n.changeOutputTypeHandler=function(t){"list"===t?n.setState({outputType:"list"}):n.setState({outputType:"chart"})},n.state={isLoading:!1,bookings:[],outputType:"list"},n}return Object(d.a)(e,t),Object(c.a)(e,[{key:"render",value:function(){var t=o.a.createElement(b,null);return this.state.isLoading||(t=o.a.createElement(a.Fragment,null,o.a.createElement(w,{activeOutputType:this.state.outputType,onChange:this.changeOutputTypeHandler}),o.a.createElement("div",null,"list"===this.state.outputType?o.a.createElement(g,{bookings:this.state.bookings,onDelete:this.deleteBookingHandler}):o.a.createElement(S,{bookings:this.state.bookings})))),o.a.createElement(a.Fragment,null,t)}}]),e}(a.Component);N.contextType=p;var _=N,x=(n(48),function(t){return o.a.createElement("div",{className:"modal"},o.a.createElement("header",{className:"modal__header"},o.a.createElement("h1",null,t.title)),o.a.createElement("section",{className:"modal__content"},t.children),o.a.createElement("section",{className:"modal__actions"},t.canCancel&&o.a.createElement("button",{className:"btn",onClick:t.onCancel},"Cancel"),t.canConfirm&&o.a.createElement("button",{className:"btn",onClick:t.onConfirm},t.confirmText)))}),O=(n(49),function(t){return o.a.createElement("div",{className:"backdrop"})}),j=(n(50),function(t){return o.a.createElement("li",{key:t.eventId,className:"event__list-item"},o.a.createElement("div",null,o.a.createElement("h1",null,t.title),o.a.createElement("h2",null,t.price,"\u20ac - ",new Date(t.date).toLocaleDateString())),o.a.createElement("div",null,t.userId!==t.creatorId?o.a.createElement("button",{className:"btn",onClick:t.onDetail.bind(void 0,t.eventId)},"View Details"):o.a.createElement("p",null,"You are the creator of this event.")))}),I=(n(51),function(t){var e=t.events.map(function(e){return console.log({event:e,other:{authUserId:t.authUserId,creatorId:e.creatorId}}),o.a.createElement(j,{key:e._id,eventId:e._id,title:e.title,price:e.price,date:e.date,userId:t.authUserId,creatorId:e.creator._id,onDetail:t.onViewDetail})});return o.a.createElement("ul",{className:"event__list"},e)}),T=(n(52),function(t){function e(t){var n;return Object(r.a)(this,e),(n=Object(s.a)(this,Object(u.a)(e).call(this,t))).isActive=!0,n.fetchEvents=function(){n.setState({isLoading:!0});fetch("http://localhost:8000/graphql",{method:"POST",body:JSON.stringify({query:"\n\t\t\t{\n\t\t\t\tevents\n\t\t\t\t{\n\t\t\t\t\t_id\n\t\t\t\t\ttitle\n\t\t\t\t\tdescription\n\t\t\t\t\tdate\n\t\t\t\t\tprice\n\t\t\t\t\tcreator{\n\t\t\t\t\t\t_id\n\t\t\t\t\t\temail\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\t"}),headers:{"Content-Type":"application/json"}}).then(function(t){if(200!==t.status&&201!==t.status)throw new Error("Failed");return t.json()}).then(function(t){console.log(t);var e=t.data.events;n.setState({events:e,isLoading:!1})}).catch(function(t){console.log(t),n.setState({isLoading:!1})})},n.startCreateEventHandler=function(){n.setState({creating:!0})},n.modalConfirmHandler=function(){n.setState({creating:!1});var t=n.titleEl.current.value,e=n.dateEl.current.value,a=+n.priceEl.current.value,o=n.descriptionEl.current.value;if(!(0===t.trim().length||a<0||0===e.trim().length||0===o.trim().length)){var i={title:t,description:o,price:a,date:e};console.log(i);var l={query:"\n\t\t\tmutation CreateEvent(\n\t\t\t\t$title: String!, \n\t\t\t\t$description: String!,\n\t\t\t\t$price: Float!, \n\t\t\t\t$date: String!\n\t\t\t\t){\n\t\t\t\tcreateEvent(eventInput: {\n\t\t\t\t\ttitle: $title,\n\t\t\t\t\tdescription: $description,\n\t\t\t\t\tprice:$price,\n\t\t\t\t\tdate: $date\n\t\t\t\t})\n\t\t\t\t{\n\t\t\t\t\t_id\n\t\t\t\t\ttitle\n\t\t\t\t\tdescription\n\t\t\t\t\tdate\n\t\t\t\t\tprice\n\t\t\t\t\tcreator{\n\t\t\t\t\t\t_id\n\t\t\t\t\t\temail\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\t",variables:{title:t,description:o,price:a,date:e}};console.log(l),fetch("http://localhost:8000/graphql",{method:"POST",body:JSON.stringify(l),headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(n.context.token)}}).then(function(t){if(200!==t.status&&201!==t.status)throw new Error("Failed");return t.json()}).then(function(t){n.isActive&&n.setState(function(e){var a=Object(k.a)(e.events);console.log("%c updatedEvents","color:red",a);var o=t.data.createEvent,i=o._id,l=o.title,r=o.description,c=o.date,s=o.price;return a.push({_id:i,title:l,description:r,date:c,price:s,creator:{_id:n.context.userId}}),console.log("%c updatedEvents","color:green",a),{events:a}})}).catch(function(t){console.log(t)})}},n.modalCancelHandler=function(){n.setState({creating:!1,selectedEvent:null})},n.showDetailHandler=function(t){n.setState(function(e){return{selectedEvent:e.events.find(function(e){return e._id===t})}})},n.bookEventHandler=function(){if(n.context.token){var t={query:"\n\t\t\tmutation BookEvent($id: ID!){\n\t\t\t\tbookEvent(eventId: $id)\n\t\t\t\t{\n\t\t\t\t\tcreatedAt\n\t\t\t\t\tupdatedAt\n\t\t\t\t}\n\t\t\t}\n\t\t\t",variables:{id:n.state.selectedEvent._id}};fetch("http://localhost:8000/graphql",{method:"POST",body:JSON.stringify(t),headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(n.context.token)}}).then(function(t){if(200!==t.status&&201!==t.status)throw new Error("Failed");return t.json()}).then(function(t){n.isActive&&(console.log(t),n.setState({selectedEvent:null}))}).catch(function(t){console.log(t)})}else n.setState({selectedEvent:null})},n.state={creating:!1,events:[],isLoading:!1,selectedEvent:null},n.titleEl=o.a.createRef(),n.priceEl=o.a.createRef(),n.dateEl=o.a.createRef(),n.descriptionEl=o.a.createRef(),n}return Object(d.a)(e,t),Object(c.a)(e,[{key:"componentDidMount",value:function(){this.fetchEvents()}},{key:"componentWillUnmount",value:function(){this.isActive=!1}},{key:"render",value:function(){return o.a.createElement(a.Fragment,null,(this.state.creating||this.state.selectedEvent)&&o.a.createElement(O,null),this.state.creating&&o.a.createElement(x,{title:"Add Event",canCancel:!0,canConfirm:!0,onCancel:this.modalCancelHandler,onConfirm:this.modalConfirmHandler,confirmText:"Confirm"},o.a.createElement("form",null,o.a.createElement("div",{className:"form-control"},o.a.createElement("label",{htmlFor:"title"},"Title"),o.a.createElement("input",{type:"text",id:"title",ref:this.titleEl})),o.a.createElement("div",{className:"form-control"},o.a.createElement("label",{htmlFor:"price"},"Price"),o.a.createElement("input",{type:"Number",id:"price",ref:this.priceEl})),o.a.createElement("div",{className:"form-control"},o.a.createElement("label",{htmlFor:"date"},"Date"),o.a.createElement("input",{type:"datetime-local",id:"date",ref:this.dateEl})),o.a.createElement("div",{className:"form-control"},o.a.createElement("label",{htmlFor:"description"},"Description"),o.a.createElement("textarea",{id:"description",ref:this.descriptionEl,rows:"4"})))),this.state.selectedEvent&&o.a.createElement(x,{title:this.state.selectedEvent.title,canCancel:!0,canConfirm:!0,onCancel:this.modalCancelHandler,onConfirm:this.bookEventHandler,confirmText:this.context.token?"Book":"Confirm"},o.a.createElement("h1",null,this.state.selectedEvent.title),o.a.createElement("h2",null,this.state.selectedEvent.price,"\u20ac -"," ",new Date(this.state.selectedEvent.date).toLocaleDateString()),o.a.createElement("p",null,this.state.selectedEvent.description)),this.context.token&&o.a.createElement("div",{className:"events-control"},o.a.createElement("p",null,"Share your own Events !"),o.a.createElement("button",{className:"btn",onClick:this.startCreateEventHandler},"Create Event")),this.state.isLoading?o.a.createElement(b,null):o.a.createElement(I,{events:this.state.events,authUserId:this.context.userId,onViewDetail:this.showDetailHandler}))}}]),e}(a.Component));T.contextType=p;var L=T,D=(n(53),function(t){return o.a.createElement(p.Consumer,null,function(t){return o.a.createElement("header",{className:"main-navigation"},o.a.createElement("div",{className:"main-navigation__logo"},o.a.createElement("h1",null,"EasyEvent")),o.a.createElement("nav",{className:"main-navigation__items"},o.a.createElement("ul",null,!t.token&&o.a.createElement("li",null,o.a.createElement(m.b,{to:"/auth"},"Login")),o.a.createElement("li",null,o.a.createElement(m.b,{to:"/events"},"Events")),t.token&&o.a.createElement(a.Fragment,null,o.a.createElement("li",null,o.a.createElement(m.b,{to:"/bookings"},"Bookings")),o.a.createElement("li",null,o.a.createElement(m.b,{to:"/events",className:"btn",onClick:t.logout},"Logout"))))))})}),$=(n(62),function(t){function e(){var t,n;Object(r.a)(this,e);for(var a=arguments.length,o=new Array(a),i=0;i<a;i++)o[i]=arguments[i];return(n=Object(s.a)(this,(t=Object(u.a)(e)).call.apply(t,[this].concat(o)))).state={token:null,userId:null},n.login=function(t,e,a){n.setState({token:t,userId:e,tokenExpiration:a})},n.logout=function(){n.setState({token:null,userId:null,tokenExpiration:null})},n}return Object(d.a)(e,t),Object(c.a)(e,[{key:"render",value:function(){return o.a.createElement(m.a,null,o.a.createElement(a.Fragment,null,o.a.createElement(p.Provider,{value:{token:this.state.token,userId:this.state.userId,login:this.login,logout:this.logout}},o.a.createElement(D,null),o.a.createElement("main",{className:"main-content"},o.a.createElement(h.d,null,this.state.token&&o.a.createElement(h.a,{from:"/",to:"/events",exact:!0}),this.state.token&&o.a.createElement(h.a,{from:"/auth",to:"/events",exact:!0}),!this.state.token&&o.a.createElement(h.b,{path:"/auth",component:v}),o.a.createElement(h.b,{path:"/events",component:L}),this.state.token&&o.a.createElement(h.b,{path:"/bookings",component:_}),!this.state.token&&o.a.createElement(h.a,{to:"/auth",exact:!0}))))))}}]),e}(a.Component));l.a.render(o.a.createElement($,null),document.getElementById("root"))}},[[25,1,2]]]);
//# sourceMappingURL=main.509aa9a5.chunk.js.map